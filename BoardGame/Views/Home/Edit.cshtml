@using WebMatrix.Data;

@{
        var db = Database.Open("BoardGame");
        var id = Request["id"];

        if (String.IsNullOrWhiteSpace(id))
        {
            Response.Redirect("/Views/Home/Index.cshtml");
        }

        // Load the current game
        dynamic game = db.QuerySingle(@"
        SELECT BGGID, Name, Description, YearPublished, MinPlayers, MaxPlayers, MfgPlayTime, ComMinPlayTime, ComMaxPlayTime,Family, imagePath
        FROM BoardGame
        WHERE BGGID = @0", id);

        string info = null;

        if (IsPost)
        {
            // Read fields
            var Name = Request["Name"];
            var Description = Request["Description"];
            var YearPublished = Request["YearPublished"];
            var MinPlayers = Request["MinPlayers"];
            var MaxPlayers = Request["MaxPlayers"];
            var MfgPlayTime = Request["MfgPlayTime"];
            var ComMinPlayTime = Request["ComMinPlayTime"];
            var ComMaxPlayTime = Request["ComMaxPlayTime"];
            var imagePath = Request["imagePath"];

            // Update all except family
            db.Execute(@"
            UPDATE BoardGame
            SET Name=@0, Description=@1, YearPublished=@2,MinPlayers=@3, MaxPlayers=@4, MfgPlayTime=@5, ComMinPlayTime=@6, ComMaxPlayTime=@7, imagePath=@8
            WHERE BGGID=@9", Name, Description, YearPublished, MinPlayers, MaxPlayers, MfgPlayTime, ComMinPlayTime, ComMaxPlayTime, imagePath, id);

            info = "Saved";

            // Reload
            game = db.QuerySingle(@"
            SELECT BGGID, Name, Description, YearPublished, MinPlayers, MaxPlayers, MfgPlayTime, ComMinPlayTime, ComMaxPlayTime, Family, imagePath
            FROM BoardGame
            WHERE BGGID = @0", id);
        }
    }
    <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8" />
        <title>Edit Board Game</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    </head>
    <body class="p-4">
        <div class="container">

            <h2 class="mb-3">Edit Board Game</h2>

            @if (!String.IsNullOrWhiteSpace(info))
            {
                <div class="alert alert-success">@info</div>
            }

            <form method="post" class="row g-3">
                <div class="col-md-6">
                    <label class="form-label">Name</label>
                    <input class="form-control" type="text" name="Name" value="@game.Name" />
                </div>

                <div class="col-md-6">
                    <label class="form-label">Year Published</label>
                    <input class="form-control" type="text" name="YearPublished" value="@game.YearPublished" />
                </div>

                <div class="col-md-12">
                    <label class="form-label">Description</label>
                    <textarea class="form-control" name="Description" rows="3">@game.Description</textarea>
                </div>

                <div class="col-md-4">
                    <label class="form-label">Min Players</label>
                    <input class="form-control" type="text" name="MinPlayers" value="@game.MinPlayers" />
                </div>
                <div class="col-md-4">
                    <label class="form-label">Max Players</label>
                    <input class="form-control" type="text" name="MaxPlayers" value="@game.MaxPlayers" />
                </div>
                <div class="col-md-4">
                    <label class="form-label">Mfg Play Time</label>
                    <input class="form-control" type="text" name="MfgPlayTime" value="@game.MfgPlayTime" />
                </div>

                <div class="col-md-4">
                    <label class="form-label">Com Min Play Time</label>
                    <input class="form-control" type="text" name="ComMinPlayTime" value="@game.ComMinPlayTime" />
                </div>
                <div class="col-md-4">
                    <label class="form-label">Com Max Play Time</label>
                    <input class="form-control" type="text" name="ComMaxPlayTime" value="@game.ComMaxPlayTime" />
                </div>

                <div class="col-md-6">
                    <label class="form-label">Image URL</label>
                    <input class="form-control" type="text" name="imagePath" value="@game.imagePath" />
                </div>

                <div class="col-md-6">
                    <label class="form-label">Family (Not yet updated)</label>
                    <input class="form-control" type="text" value="@game.Family" disabled />
                </div>

                <div class="col-12 d-grid d-sm-block">
                    <button type="submit" class="btn btn-primary">Save</button>
                    <a class="btn btn-outline-secondary ms-sm-2 mt-2 mt-sm-0" href="/Views/Home/Details.cshtml?id=@game.BGGID">Back</a>
                </div>
            </form>

        </div>
    </body>
</html>
