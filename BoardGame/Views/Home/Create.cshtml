@using WebMatrix.Data;

@{
    var db = Database.Open("BoardGame");

    var families = db.Query("SELECT FamilyCode, Family FROM GameFamily ORDER BY Family");


    var Name = Request["Name"];
    var Description = Request["Description"];
    var YearPublished = Request["YearPublished"];
    var MinPlayers = Request["MinPlayers"];
    var MaxPlayers = Request["MaxPlayers"];
    var MfgPlayTime = Request["MfgPlayTime"];
    var ComMinPlayTime = Request["ComMinPlayTime"];
    var ComMaxPlayTime = Request["ComMaxPlayTime"];
    var FamilySelect = Request["FamilySelect"];
    var FamilyNew = Request["FamilyNew"];
    var ImagePath = Request["ImagePath"];

    if (IsPost)
    {

        var FinalFamily = "";
        if (!String.IsNullOrWhiteSpace(FamilyNew))
        {
            FinalFamily = FamilyNew;
        }
        else if (!String.IsNullOrWhiteSpace(FamilySelect))
        {
            FinalFamily = FamilySelect;
        }
        else
        {
            FinalFamily = null;
        }

        var insertSql =
            "INSERT INTO BoardGame " +
            "(Name, Description, YearPublished, MinPlayers, MaxPlayers, " +
            " MfgPlayTime, ComMinPlayTime, ComMaxPlayTime, Family, imagePath) " +
            "VALUES (@0,@1,@2,@3,@4,@5,@6,@7,@8,@9)";

        db.Execute(insertSql,
            Name, Description, YearPublished, MinPlayers, MaxPlayers,
            MfgPlayTime, ComMinPlayTime, ComMaxPlayTime, FinalFamily, ImagePath);

        Response.Redirect("/Views/Home/Index.cshtml");
    }
}

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Add a New Game</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>
<body class="p-3">
    <div class="container">
        <h2>Add a New Game</h2>

        <form method="post">
            <label class="form-label">Name</label>
            <input class="form-control mb-2" name="Name" value="@Name" />

            <label class="form-label">Year Published</label>
            <input class="form-control mb-2" type="number" name="YearPublished" value="@YearPublished" />

            <label class="form-label">Min Players</label>
            <input class="form-control mb-2" type="number" name="MinPlayers" value="@MinPlayers" />

            <label class="form-label">Max Players</label>
            <input class="form-control mb-2" type="number" name="MaxPlayers" value="@MaxPlayers" />

            <label class="form-label">Mfg Play Time</label>
            <input class="form-control mb-2" type="number" name="MfgPlayTime" value="@MfgPlayTime" />

            <label class="form-label">Com Min Play Time</label>
            <input class="form-control mb-2" type="number" name="ComMinPlayTime" value="@ComMinPlayTime" />

            <label class="form-label">Com Max Play Time</label>
            <input class="form-control mb-2" type="number" name="ComMaxPlayTime" value="@ComMaxPlayTime" />

            <label class="form-label">Select Existing Family</label>
            <select class="form-select mb-2" name="FamilySelect">
                <option value="">none</option>
                @foreach (var f in families)
                {
                    if (f.FamilyCode == FamilySelect)
                    {
                        <option value="@f.FamilyCode" selected>@f.Family</option>
                    }
                    else
                    {
                        <option value="@f.FamilyCode">@f.Family</option>
                    }
                }
            </select>

            <label class="form-label">Or Add a New Family</label>
            <input class="form-control mb-2" name="FamilyNew" value="@FamilyNew" />

            <label class="form-label">Image URL</label>
            <input class="form-control mb-2" name="ImagePath" value="@ImagePath" />

            <label class="form-label">Description</label>
            <textarea class="form-control mb-3" name="Description" rows="4">@Description</textarea>

            <button type="submit" class="btn btn-primary">Save</button>
            <a href="/Views/Home/Index.cshtml" class="btn btn-secondary">Cancel</a>
        </form>
    </div>
</body>
</html>